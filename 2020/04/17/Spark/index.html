<!DOCTYPE HTML>
<html lang="zh-Hans">




<head>
    <meta charset="utf-8">
    <meta name="keywords" content="Spark, 博客乐园">
    <meta name="description" content="Spark学习笔记，持续更新......">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Spark | 博客乐园</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">
    
    <script src="/libs/jquery/jquery.min.js"></script>
    
<meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="博客乐园" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>



<body>
    
<!-- 樱花特效 -->

        <script type="text/javascript">
            var windowWidth = $(window).width();
            if (windowWidth > 768) {
                if(new Date().getHours()%2==1){
                document.write('<script type="text/javascript" src="/js/sakura.js"><\/script>');
                }               
            }
        </script>
    
<header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper head-container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">博客乐园</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>文章分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>文章归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于我</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>技术大佬</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜一搜" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>

<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">博客乐园</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			文章分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			文章归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于我
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			技术大佬
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>

        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/21.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">Spark</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        height: calc(100vh - 250px);
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link::before {
        background-color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/big-data/">
                                <span class="chip bg-color">big_data</span>
                            </a>
                        
                            <a href="/tags/Spark/">
                                <span class="chip bg-color">Spark</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/big-data/" class="post-category">
                                big_data
                            </a>
                        
                            <a href="/categories/big-data/Spark/" class="post-category">
                                Spark
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2020-04-17
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2020-05-05
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>字数:&nbsp;&nbsp;
                    4.8k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    19 分钟
                </div>
                
				
                
                    <span id="busuanzi_container_page_pv" style="display:none"></span>
                        <i class="far fa-eye fa-fw"></i>阅读量:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    
				
            </div>
            
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <p>[toc]</p>
<h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><ul>
<li><p>学习网站：</p>
<p> <a href="http://spark.apache.org/" target="_blank" rel="noopener">http://spark.apache.org/</a>  —-官网</p>
<p><a href="https://databricks.com/spark/about" target="_blank" rel="noopener">https://databricks.com/spark/about</a> —-关注其中的Blog</p>
<p><a href="https://github.com/apache/spark" target="_blank" rel="noopener">https://github.com/apache/spark</a> —-相关源码</p>
</li>
</ul>
<p>Apache Spark™是用于大规模数据处理的统一分析引擎。</p>
<h4 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h4><p>官网-download。</p>
<img src="/2020/04/17/Spark/1_%E5%A6%82%E4%BD%95%E4%B8%8B%E8%BD%BD.png" class="">

<p>将Spark源码下载并解压</p>
<h4 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h4><ul>
<li>编译方式<ul>
<li>Maven编译</li>
<li>SBT编译</li>
<li>打包编译make-distribution.sh</li>
</ul>
</li>
</ul>
<p><strong>选择Maven方式编译</strong>。</p>
<img src="/2020/04/17/Spark/2_build%E9%9C%80%E8%A6%81%E6%B3%A8%E6%84%8Fmaven%E5%92%8Cjava%E7%89%88%E6%9C%AC.png" class="">

<p>spark的编译对maven，java版本有要求，下载并解压相应版本的Maven和Java。</p>
<p>(a)</p>
<pre class=" language-shell"><code class="language-shell">#配置JAVA_HOME
$ sudo vi /etc/profile
export JAVA_HOME=/XXX/XXX/jdkX.X.X_XX
export PATH=$PATH:$JAVA_HOME/bin</code></pre>
<p>编辑退出后，使用<code>source /etc/profile</code>使之生效；</p>
<pre class=" language-shell"><code class="language-shell">#如果遇到不能加载当前版本的问题
rpm -qa|grep jdk
rpm -e --nodeps jdk版本
which java 删除/usr/bin/java</code></pre>
<p>(b)</p>
<pre class=" language-shell"><code class="language-shell">$ sudo vi /etc/profile
export MAVEN_HOME=
export PATH=$PATH:$MAVEN_HOME/bin
#configure Maven to use more memory than usual by setting MAVEN_OPTS
export MAVEN_OPTS="-Xmx2g -XX:MaxPermSize=1024M -XX:ReservedCodeCacheSize=1024M"</code></pre>
<p>​    PS：</p>
<pre class=" language-markdown"><code class="language-markdown"><span class="token comment" spellcheck="true">&lt;!--ReservedCodeCacheSize是可选的，但是不写的话可能会出错--></span>
[INFO] Compiling 203 Scala sources and 9 Java sources to /Users/me/Development/spark/core/target/scala-2.12/classes...
[ERROR] Java heap space -> [Help 1]</code></pre>
<p>编辑退出后，使用<code>source /eytc/profile</code>使之生效；</p>
<pre class=" language-sh"><code class="language-sh">#/etc/resolv.conf:添加如下内容
nameserver 8.8.8.8
nameserver 8.8.4.4

#spark/dev/make-distribution.sh
#Spark的版本
VERSION=
#Scala的版本
SCALA_VERSION=
#Hadoop的版本
SPARK_HADOOP_VERSION=
#支持spark on hive
SPARK_HIVE=1
#加快编译速度</code></pre>
<pre class=" language-shell"><code class="language-shell">#编译时网络要外网连接
$./dev/make-distribution.sh --name custom-spark --tgz -Phadoop-X.X -Phive -Phive-thriftserver  -Pyarn

#编译完成之后解压

tar -zxf spark-X.X.X-bin-custom-spark.tgz -C /opt/modules/</code></pre>
<h4 id="Scala安装"><a href="#Scala安装" class="headerlink" title="Scala安装"></a>Scala安装</h4><p>官网中描述对于Sacla的版本也是有要求的，将相应版本的Scala下载解压到指定目录。</p>
<p>配置环境变量</p>
<pre class=" language-shell"><code class="language-shell">$ sudo vi /etc/profile
export SCALA_HOME=/XXX/XXX/scala-X.XX.X
export PATH=$PATH:$SCALA_HOME/bin
$ source /etc/profile</code></pre>
<h4 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h4>

<p>Spark运行模式：</p>
<ul>
<li><p>Local</p>
<p>将网络切换至内网，进入Spark安装目录，执行<code>./bin/spark-shell</code></p>
</li>
<li><p>Standalone(Spark自身的集群管理)</p>
<p>需要安装JDK、Scala、Hadoop、Spark Standalone（只需要在集群中每个节点上安装一个Spark的编译版本）</p>
<img src="/2020/04/17/Spark/spark%E9%9B%86%E7%BE%A4%E6%9E%B6%E6%9E%84%E5%9B%BE.png" class="">

<p><code>$./sbin/start-master.sh</code>：启动一个standalone master服务，一旦启动，master将打印<code>spark://HOST:PORT</code>URL，这个URL可以连接workers，或者作为”master”参数传递给SparkContext，也可以在master’s的web UI中发现这个URL。</p>
<p><code>$./sbin/start-slave.sh &lt;master-spark-URL&gt;</code>：启动workers，并连接master。</p>
<p>使用脚本启动Spark standalone 集群，需要在Spark目录下创建conf/slaves文件，并在文件中写入计划运行Spark workers机器的hostname，如果该文件不存在，默认启动Local模式。注意：master机器可以无密钥连接每一个worker。</p>
<pre class=" language-sh"><code class="language-sh">#slaves：一行一个
worker1 所在的hotname
worker2 所在的hotname</code></pre>
<p>那么可以在<code>Spark master</code>上运行以下脚本：</p>
<pre class=" language-shell"><code class="language-shell">#Starts a master instance on the machine the script is executed on.
$ sbin/start-master.sh
#Starts a slave instance on each machine specified in the conf/slaves file.
$ sbin/start-slaves.sh  
#Starts a slave instance on the machine the script is executed on.
$ sbin/start-slave.sh
#Starts both a master and a number of slaves as described above.
$ sbin/start-all.sh
 #Stops the master that was started via the sbin/start-master.sh script.
$ sbin/stop-master.sh
#Stops all slave instances on the machines specified in the conf/slaves file.
$ sbin/stop-slaves.sh 
 #Stops both the master and the slaves as described above
$ sbin/stop-all.sh</code></pre>
<p>通过<code>conf/spark-env.sh</code>进一步配置集群，可以参考<code>conf/spark-env.sh.template</code>，然后将该文件复制到所有worker机器上。</p>
<pre class=" language-sh"><code class="language-sh">#spark-env.sh
export JAVA_HOME=/XXX/XXX/jdkX.X.X_XX
export SCALA_HOME=/XXX/XXX/scala-X.XX.X
#配置这一项时，hadoop集群得启动
export HADOOP_CONF_DIR=/opt/modules/hadoop-X.X.X/etc/hadoop
export SPARK_CONF_DIR=/opt/modules/spark-X.X.X/conf
#绑定master，填写hostname or IP address
export SPARK_MASTER_HOST=
#默认是7077
export SPARK_MASTER_PORT=7077
#master web UI的端口，默认是8080
export SPARK_MASTER_WEBUI_PORT=8080
#允许Spark 程序使用的内核总数
export SPARK_WORKER_CORES=1
#saprk程序使用的内存总数
export SPARK_WORKER_MEMORY=1g
#Spark worker启动的端口，默认random
export SPARK_WORKER_PORT=7078
#worker web UI的端口8081
export SPARK_WORKER_WEBUI_PORT=8081</code></pre>
<p>将应用程序连接到集群,只需要将master的URL（spark://IP:PORT）传递给SparkContext构造器。运行一个交互Spark shell：<code>$./bin/saprk-shell --master spark://IP:ROOT</code>。</p>
<p><code>spark-submit</code>脚本提交编译的Spark应用程序到集群中。对于standalone集群，Spark有两种deploy modes：1.client（  the driver is launched in the same process as the client that submits the application ）2.cluster（ the driver is launched from one of the Worker processes inside the cluster, and the client process exits as soon as it fulfills its responsibility of submitting the application without waiting for the application to finish ）。如果你的应用程序通过Spark submit运行，则应用程序自动分发给所有的worker节点，应用程序所依赖的jar包，通过–jars jar1,jar2</p>
</li>
<li><p>YARN</p>
<p>确保HADOOP_CONF_DIR或者YARN_CONF_DIR指向包含Hadoop集群客户端配置文件的目录。这些配置用于向HDFS执行写操作合连接YARN ResourceManager。</p>
<p>在YARN上运行Spark应用程序有两种deploy mode：</p>
<ul>
<li>cluster mode：</li>
<li>client mode：</li>
</ul>
</li>
<li><p>Mesos(Spark初期支持)</p>
</li>
</ul>
<h3 id="Spark-Core"><a href="#Spark-Core" class="headerlink" title="Spark Core"></a>Spark Core</h3><h4 id="RDD（resilient-dastributed-dataset）"><a href="#RDD（resilient-dastributed-dataset）" class="headerlink" title="RDD（resilient dastributed dataset）"></a>RDD（resilient dastributed dataset）</h4><h5 id="2大创建："><a href="#2大创建：" class="headerlink" title="2大创建："></a>2大创建：</h5><ul>
<li><p>Parallelized Collections</p>
<p>将已经存在的数据集转化成rdd/其他RDD转化形成新的RDD，<strong>一般在进行测试的时候使用</strong></p>
<pre class=" language-shell"><code class="language-shell">#sc即SparkContext
val data = Array(1,2,3,4,5)
#第二个参数10是手动创建的partitions，可选参数
val rdd = sc.parallelize(data,10)</code></pre>
</li>
<li><p>External Datasets</p>
<p>由外部存储系统的数据集创建，包括本地的文件系统，还有所有Hadoop支持的数据集，比如HDFS、HBase。</p>
<pre class=" language-shell"><code class="language-shell">#URI(Uniform Resource Identifier，统一资源标识符),而URL（URL：Uniform Resource Location统一资源定位符），URL是URI的子集
#参数是文件的URI（file///，还可以是hdfs://,）
val distFile = sc.textFile("data.txt")
distFile: org.apache.spark.rdd.RDD[String] = data.txt MapPartitionsRDD[10] at textFile at <console>:26</code></pre>
</li>
</ul>
<h5 id="5大特性"><a href="#5大特性" class="headerlink" title="5大特性"></a>5大特性</h5><pre class=" language-markdown"><code class="language-markdown"><span class="token comment" spellcheck="true">&lt;!--源码中的描述--></span>
<span class="token list punctuation">*</span>  <span class="token list punctuation">-</span> A list of partitions
<span class="token list punctuation">*</span>  <span class="token list punctuation">-</span> A function for computing each split
<span class="token list punctuation">*</span>  <span class="token list punctuation">-</span> A list of dependencies on other RDDs
<span class="token list punctuation">*</span>  <span class="token list punctuation">-</span> Optionally, a Partitioner for key-value RDDs (e.g. to say that the RDD is hash-partitioned)
<span class="token list punctuation">*</span>  <span class="token list punctuation">-</span> Optionally, a list of preferred locations to compute each split on (e.g. block locations for an HDFS file)
</code></pre>
<ul>
<li><p><strong>一组分片（Partition），即数据集的基本组成单位</strong>。 对于RDD来说，每个分片都会被一个计算任务处理，并决定并行计算的粒度。用户可以在创建RDD 的时候指定RDD的分片个数，如果没有指定，那么就会采用默认值。默认值就是程序所分配到的CPU Cores 的数目；</p>
</li>
<li><p><strong>对于RDD来说，每个分片都会被一个计算任务处理，并决定并行计算的粒度</strong>。Spark中RDD的计算是以分片为单位的，每个RDD都会实现compute函数以达到这个目的。compute函数会对迭代器进行复合，不需要保存每次计算的结果；</p>
</li>
<li><p><strong>RDD 之间互相存在依赖关系</strong>。 RDD 的每次转换都会生成一个新的 RDD ,所以 RDD 之间就会形成类似于流水线一样的前后依赖关系。在部分分区数据丢失时，Spark 可以通过这个依赖关系重新计算丢失部分的分区数据，而不是对 RDD 的所有分区进行重新计算。—具有容错性</p>
</li>
<li><p><strong>一个Partitioner ，即 RDD 的分片函数</strong> 。当前Spark 中实现了两种类型的分片函数，一个是基于哈希的 HashPartitioner ，另外一个是基于范围的 RangePartitioner。只有对于<strong>key-value</strong>的RDD ,才会有 Partitioner,非 key-value 的RDD 的 Partitioner 的值是None。Partitioner 函数不但决定了RDD 本身的分片数量，也决定了 Parent RDD Shuffle 输出时的分片数量。</p>
</li>
<li><p><strong>一个列表，存储存取每个Partition 的优先位置（preferred location）</strong>。 对于一个HDFS 文件来说，这个列表保存的就是每个 Partition 所在的块位置。根据<strong>“移动数据不如移动计算”</strong>的理念，Spark 在进行任务调度的时候，会尽可能地将计算任务分配到其所要处理数据块的存储位置。</p>
</li>
</ul>
<h5 id="3大操作方式（算子）："><a href="#3大操作方式（算子）：" class="headerlink" title="3大操作方式（算子）："></a>3大操作方式（算子）：</h5><p>transformations：数据内容不会变化，形式改变，懒加载，只有在actions阶段才执行。</p>
<table>
<thead>
<tr>
<th align="center">操作</th>
<th align="center">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><strong>map(func)</strong></td>
<td align="center">返回一个新的RDD,该RDD由每一个输入元素经func函数转换后组成</td>
</tr>
<tr>
<td align="center"><strong>filter(func)</strong></td>
<td align="center">返回一个新的RDD，该RDD由经过func函数计算后返回值为true的输入元素组成</td>
</tr>
<tr>
<td align="center"><strong>flatMap(func)</strong></td>
<td align="center">类似于map，但是每一个输入元素可以被映射为0或多个输出元素（所以func应该返回一个序列，而不是单一元素）</td>
</tr>
<tr>
<td align="center"><strong>repartition</strong>(numPartitions)</td>
<td align="center">重新分区</td>
</tr>
<tr>
<td align="center"><strong>join</strong>(otherDataset, [numTasks])</td>
<td align="center">在类型为(K,V)和(K,W)的RDD上调用，返回一个相同key对应的所有元素对在一起的(K,(V,W))的RDD 相当于内连接（求交集）</td>
</tr>
<tr>
<td align="center"><strong>sample</strong>(withReplacement, fraction, seed)</td>
<td align="center">根据fraction指定的比例对数据进行采样，可以选择是否使用随机数进行替换，seed用于指定随机数生成器种子</td>
</tr>
<tr>
<td align="center"><strong>union</strong>(otherDataset)</td>
<td align="center">对源RDD和参数RDD求并集后返回一个新的RDD</td>
</tr>
<tr>
<td align="center"><strong>intersection</strong>(otherDataset)</td>
<td align="center">对源RDD和参数RDD求交集后返回一个新的RDD</td>
</tr>
<tr>
<td align="center"><strong>distinct</strong>([numTasks]))</td>
<td align="center">对源RDD进行去重后返回一个新的RDD</td>
</tr>
<tr>
<td align="center"><strong>groupByKey</strong>([numTasks])</td>
<td align="center">在一个(K,V)的RDD上调用，返回一个(K, Iterator[V])的RDD</td>
</tr>
<tr>
<td align="center"><strong>reduceByKey</strong>(func, [numTasks])</td>
<td align="center">在一个(K,V)的RDD上调用，返回一个(K,V)的RDD，使用指定的reduce函数，将相同key的值聚合到一起，与groupByKey类似，reduce任务的个数可以通过第二个可选的参数来设置</td>
</tr>
<tr>
<td align="center"><strong>sortByKey</strong>([ascending], [numTasks])</td>
<td align="center">在一个(K,V)的RDD上调用，K必须实现Ordered接口，返回一个按照key进行排序的(K,V)的RDD</td>
</tr>
<tr>
<td align="center"><strong>sortBy</strong>(func,[ascending], [numTasks])</td>
<td align="center">与sortByKey类似，但是更灵活 第一个参数是根据什么排序 第二个是怎么排序 false倒序  第三个排序后分区数 默认与原RDD一样</td>
</tr>
<tr>
<td align="center"><strong>cogroup</strong>(otherDataset, [numTasks])</td>
<td align="center">在类型为(K,V)和(K,W)的RDD上调用，返回一个(K,(Iterable<V>,Iterable<W>))类型的RDD</td>
</tr>
</tbody></table>
<p>actions：</p>
<table>
<thead>
<tr>
<th>操作</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td><strong>reduce</strong>(<em>func</em>)</td>
<td>通过func函数聚集RDD中的所有元素，这个功能必须是可交换且可并联的</td>
</tr>
<tr>
<td><strong>collect</strong>()</td>
<td>以数组的形式返回数据集的所有元素</td>
</tr>
<tr>
<td><strong>count</strong>()</td>
<td>返回RDD的元素个数</td>
</tr>
<tr>
<td><strong>first</strong>()</td>
<td>返回RDD的第一个元素</td>
</tr>
<tr>
<td><strong>take</strong>(<em>n</em>)</td>
<td>返回一个由数据集的前n个元素组成的数组</td>
</tr>
<tr>
<td><strong>saveAsTextFile</strong>(<em>path</em>)</td>
<td>将数据集的元素以textfile的形式保存到HDFS文件系统或者其他支持的文件系统，对于每个元素，Spark将会调用toString方法，将它装换为文件中的文本</td>
</tr>
<tr>
<td><strong>countByKey</strong>()</td>
<td>针对(K,V)类型的RDD，返回一个(K,Int)的map，表示每一个key对应的元素个数</td>
</tr>
<tr>
<td><strong>foreach</strong>(<em>func</em>）</td>
<td>在数据集的每一个元素上，运行函数func进行更新</td>
</tr>
<tr>
<td><strong>lookup</strong></td>
<td>对&lt;key,value&gt;型的rdd操作，返回指定key对应的元素形成的seq。如果这个rdd包含分区器，那么只扫描对应key所在的分区，若不含，则进行全盘扫描</td>
</tr>
</tbody></table>
<p>controller：</p>
<table>
<thead>
<tr>
<th>操作</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td><strong>cache</strong></td>
<td>只有一个默认的缓存级别MeMORY-ONLY，cache调用了persist</td>
</tr>
<tr>
<td><strong>persist</strong></td>
<td>可以根据情况设置其缓存级别</td>
</tr>
<tr>
<td>用处：</td>
<td>两者都是用来将一个RDD进行缓存的，避免重复计算，从而节省程序运行的时间。</td>
</tr>
</tbody></table>
<h3 id="Spark-SQL"><a href="#Spark-SQL" class="headerlink" title="Spark SQL"></a>Spark SQL</h3><h4 id="DataFrame"><a href="#DataFrame" class="headerlink" title="DataFrame"></a>DataFrame</h4><p>DataFrame是Spark 1.3添加的接口，类似于传统数据库的二维表格或者 R 和 Python 中的一个 data frame，除了数据之外，还记录数据的结构信息，即schema；与Hive类似，DataFrame也支持嵌套数据类型（struct、array、map） DataFrame 是按命名列方式组织的一个 Dataset。DataFrame 可以从很多数据源构造得到，比如：结构化的数据文件，Hive 表，外部数据库或现有的 RDD。</p>
<pre class=" language-scala"><code class="language-scala"><span class="token keyword">val</span> df <span class="token operator">=</span> spark<span class="token punctuation">.</span>read<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token string">"examples/src/main/resources/people.json"</span><span class="token punctuation">)</span></code></pre>
<h4 id="DataSet"><a href="#DataSet" class="headerlink" title="DataSet"></a>DataSet</h4><p> Dataset 是一个分布式数据集，它是 <code>Spark 1.6</code> 版本中新增的一个接口, 它结合了 RDD（强类型，可以使用强大的 lambda 表达式函数） 和 Spark SQL 的优化执行引擎的好处。Dataset 可以从 JVM 对象构造得到，可以使用函数式的变换（map，flatMap，filter 等） 进行操作 。</p>
<pre class=" language-scala"><code class="language-scala"><span class="token keyword">case</span> <span class="token keyword">class</span> Person<span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token builtin">Long</span><span class="token punctuation">)</span>
<span class="token keyword">val</span> caseClassDS <span class="token operator">=</span> Seq<span class="token punctuation">(</span>Person<span class="token punctuation">(</span><span class="token string">"Andy"</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>toDS<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<h4 id="RDD、DataFrame、DataSet三者之间的异同"><a href="#RDD、DataFrame、DataSet三者之间的异同" class="headerlink" title="RDD、DataFrame、DataSet三者之间的异同"></a>RDD、DataFrame、DataSet三者之间的异同</h4><img src="/2020/04/17/Spark/RDD%E4%B8%8EDataFrame.png" class="">

<p>RDD中以对象为类型参数，Spark框架并不了解内部结构；而DataFrame提供了详细的结构信息，Spark SQL可以清楚地知道该数据集中包含哪些列，每列的名称和类型。RDD是分布式的Java对象的集合，DataFrame也叫做DataSet[Row],是分布式的Row对象的集合。</p>
<p>如果同样的数据都给这三种数据集，他们分别计算之后，会给出相同的结果，但是执行效率和方式有所不同。</p>
<p>针对数据查询应用，在RDD之上，封装了DataFrame</p>
<h4 id="与Hive集成"><a href="#与Hive集成" class="headerlink" title="与Hive集成"></a>与Hive集成</h4><p>为什么要进行整合？</p>
<p>hive原生是基于MapReduce的，导致其查询耗时较长。<br>为了保留Hive的架构解决方案，并优化查询速度，采用SparkSql与hive整合(spark on hive)，通过<code>SparkSql读取hive中表的元数据</code>，把HiveHQL底层采用MapReduce处理任务导致性能慢的特点，改为更加强大的<code>Spark引擎来进行相应的计算处理</code>。</p>
<ul>
<li><p>Spark-shell</p>
<p>需要的配置(spark集群)</p>
<p>1.拷贝Hive的配置文件Hive-site.xml，core-site.xml，HDFS的配置文件 hdfs-site.xml到Spark的conf目录;</p>
<p>2.拷贝hive中的mysql jar包到spark的jars目录;</p>
<p>3.检查spark-env.sh文件中hadoop的配置项;</p>
<pre class=" language-sh"><code class="language-sh">export HADOOP_CONF_DIR=/opt/modules/hadoop-2.6.0/etc/hadoop</code></pre>
</li>
</ul>
<p>需要启动的服务</p>
<p>1.sudo service mysqld start</p>
<p>  2.bin/hive –service metastore</p>
<p>Spark-sql</p>
<p>  不需要配置，spark-shell能运行，这个也可以运行。</p>
<p>  beeline:</p>
<h4 id="与HBase集成"><a href="#与HBase集成" class="headerlink" title="与HBase集成"></a>与HBase集成</h4><p>其核心就是Spark SQL通过Hive外部表来获取HBase的表数据</p>
<p>拷贝Hbase的包和Hive的包放到Spark的jars目录下：</p>
<pre class=" language-markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span>hbase安装目录下</span>
hbase-client-x.x.x.jar
hbase-common-x.x.x.jar
hbase-protocol-x.x.x.jar
hbase-server-x.x.x.jar
<span class="token title important"><span class="token punctuation">#</span>hive安装目录下</span>
hive-hbase-handler-x.x.x.jar
htrace-core-x.x.jar
mysql-connector-java-x.x.x-bin.jar</code></pre>
<h3 id="Spark-Streaming"><a href="#Spark-Streaming" class="headerlink" title="Spark Streaming"></a>Spark Streaming</h3><p>​    Spark Streaming 是对<strong>Spark 核心API 的一个扩展</strong>，它能够实现对实时数据流的流式处理，并具有很好的可扩展性、高吞吐量和容错性。Spark Streaming 支持从多种数据源提取数据，如：<strong>Kafka、Flume</strong>、Twitter、ZeroMQ、Kinesis 以及 <strong>TCP 套接字</strong>，并且可以提供一些高级 API 来表达复杂的处理算法，如：map、reduce、join 和 window 等。最后，Spark Streaming 支持将处理完的数据推送到文件系统、数据库或者  live dashboards 中展示 。 还可以将 Spark 的机器学习（machine learning） 和 图计算（graph processing）的算法应用于Spark Streaming 的数据流当中 。</p>
<img src="/2020/04/17/Spark/streaming-arch.png" class="">

<p>工作原理</p>
<p>Spark Streaming 接收实时输入数据流并根据<code>自定义的时间间隔</code>将数据划分为一个个小的批次供 Spark Engine （其实是Spark Core）处理，最终生成多个批次的结果流（ 而<strong>Storm是来一条数据处理一条数据，是真正意义上的实时处理</strong>）。 其底层操作还是基于RDD的，只不过针对实时计算的特点，在RDD之上封装了DStream（被分成的一段段的数据）。每一段数据都可以转换成RDD，从而将对DStream的操作变成了对RDD的操作，RDD经过操作之后变成中间结果保存在内存中，也可以根据业务需求对中间结果进行缓存/存储到外部设备。</p>
<img src="/2020/04/17/Spark/streaming-flow.png" class="">

<h3 id="Structured-Streaming"><a href="#Structured-Streaming" class="headerlink" title="Structured Streaming"></a>Structured Streaming</h3><p>出现的原因：</p>
<ul>
<li>以RDD为核心的API逐步升级到DataSet/DataFrame上；</li>
<li>以RDD为基础的编程模型对开发人员的要求较高，需要足够的编程背景才能够胜任Spark Streaming的编程工作</li>
</ul>
<p>Structured Streaming是一种<strong>基于Spark SQL引擎的可扩展且容错的流处理引擎</strong>。可以像表达静态数据的批处理计算一样表达流式计算。Spark SQL引擎将负责逐步和连续地运行它，并在流数据继续到达时更新最终结果。可以使用Scala，Java，Python或R中的数据集/数据框架API来表示流聚合，事件时间窗口，流到批处理连接等。计算在同一优化的Spark SQL引擎上执行。最后，系统通过检查点和预写日志确保端到端的一次性容错保证。简而言之，<strong>结构化流传输提供快速，可扩展，容错，端到端的精确一次流处理，而无需用户推理流式传输</strong>。</p>
<p>Structured Streaming 将数据源和计算结果都看做是无限大的表，数据源中每个批次的数据，经过计算，都添加到结果表中作为行。</p>


<p>借助官网的例子理解一下Structured Streaming的运作方式，每次流入的数据会作为一行新数据添加到Unbounded Table上，同时将流式计算的结果映射为另外一张表，完全以结构化的方式操作流式数据。</p>


<p>输出模式：</p>
<p>update： 输出只有自上次触发后在结果表中<strong>更新的行</strong>；</p>
<p> append ： 输出自上次触发后，结果表中<strong>附加的新行</strong>。这仅适用于预计结果表中的现有行不会更改的查询 ；</p>
<p>complete： 输出<strong>整个更新的结果表</strong>。</p>
<h3 id="使用IntelliJ-IDEA构建Maven管理的Spark项目"><a href="#使用IntelliJ-IDEA构建Maven管理的Spark项目" class="headerlink" title="使用IntelliJ IDEA构建Maven管理的Spark项目"></a>使用IntelliJ IDEA构建Maven管理的Spark项目</h3><h4 id="Maven安装与配置"><a href="#Maven安装与配置" class="headerlink" title="Maven安装与配置"></a>Maven安装与配置</h4><p>参考文献： <a href="https://how2j.cn/k/idea/idea-maven-config/1353.html#nowhere" target="_blank" rel="noopener">https://how2j.cn/k/idea/idea-maven-config/1353.html#nowhere</a> </p>
<p>打开官网：<a href="http://maven.apache.org/download.cgi，在`Previous" target="_blank" rel="noopener">http://maven.apache.org/download.cgi，在`Previous</a> Releases<code>处点击</code>archives<code>进入版本下载页面。下载并解压，配置环境变量新增</code>M2_HOME<code>,并修改</code>Path<code>，</code>cmd<code>窗口执行</code>mvn -v`看到maven的当前版本即配置成功。</p>
<p>修改maven/conf/settings.xml</p>
<pre class=" language-xml"><code class="language-xml"> <span class="token comment" spellcheck="true">&lt;!-- localRepository
   | The path to the local repository maven will use to store artifacts.
   |
   | Default: ${user.home}/.m2/repository
  &lt;localRepository>/path/maven/repo&lt;/localRepository>
  --></span>
将注释去掉，将 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>localRepository</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>localRepository</span><span class="token punctuation">></span></span>修改为自定义repository的路径。</code></pre>
<p>打开idea，进行maven配置：<code>File-Settings-Build,Execution,Deployment-Build Tools-Maven</code>修改’Maven home directory’、’User settings file’、’Local repository’，点击’apply’-‘ok’按钮结束。</p>
<h4 id="Scala-for-windows下载"><a href="#Scala-for-windows下载" class="headerlink" title="Scala for windows下载"></a>Scala for windows下载</h4><p>确保本地已安装JDK1.5以上版本，并设置了JAVA_HOME环境变量及JDK的bin目录。</p>
<p>官网<a href="http://www.scala-lang.org/downloads下载Scala，安装完成之后，进行环境变量的配置，新建&#39;SCALA_HOME&#39;，编辑&#39;Path&#39;，cmd窗口输入&#39;scala&#39;检测是否成功。" target="_blank" rel="noopener">http://www.scala-lang.org/downloads下载Scala，安装完成之后，进行环境变量的配置，新建&#39;SCALA_HOME&#39;，编辑&#39;Path&#39;，cmd窗口输入&#39;scala&#39;检测是否成功。</a></p>
<h4 id=""><a href="#" class="headerlink" title=""></a></h4><p>主要分为以下几个步骤（参考文献： <a href="https://blog.csdn.net/zkf541076398/article/details/79297820" target="_blank" rel="noopener">https://blog.csdn.net/zkf541076398/article/details/79297820</a> ）：</p>
<ul>
<li><p>安装Scala 插件</p>
<p>a.可以在idea中直接通过File-&gt;Settings-&gt;Plugins安装（没有安装成功，可能是网慢）；</p>
<p>b.也可以去官网（ <a href="https://plugins.jetbrains.com/plugin/1347-scala/versions" target="_blank" rel="noopener">https://plugins.jetbrains.com/plugin/1347-scala/versions</a> ）下载对应的版本（!!!!!一定要在idea中确定所需插件的版本），将下载的.zip文件放在idea的plugins目录下，或者其他目录下，通过<code>Install plugin from disk...</code>进行安装。<strong>记得重启idea，使插件生效</strong>。</p>
</li>
<li><p>JDK和Sacla SDK</p>
<p>为了不用每个项目都配置JDK和Library，从而进行全局配置<code>File-Other Settings-Default Project Structure</code>在<code>project</code>页面配置JDK，在<code>Global Libraries</code>页面添加Scala SDK</p>
</li>
<li><p>新建maven项目</p>
<p>打开新建好项目的Project Structure窗口，将Scala SDK添加到Libraries下，注意新建Scala文件时，应该选择<code>Object</code>,而不是<code>class</code>,否则没有run按钮，<strong>为什么不会出现呢？？？？</strong></p>
<p>点击运行按钮之后出现</p>
<p><code>java.io.IOException: Could not locate executable D:\xuling\ideaWorkSpce\bigData_software\hadoop-2.6.0\bin\winutils.exe in the Hadoop binaries.</code></p>
<p>该bin文件内缺少winutils.exe，用以2.6.4目录下的下文件代替即可</p>
</li>
<li><p>导入spark依赖</p>
<p>修改pom.xml,可以参考（ <a href="https://github.com/apache/spark/blob/master/examples/pom.xml" target="_blank" rel="noopener">https://github.com/apache/spark/blob/master/examples/pom.xml</a> ）例子</p>
</li>
<li><p>编写spark代码</p>
</li>
<li><p>打包在spark上运行</p>
</li>
</ul>

            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        Manba_girl:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://xlxlll.github.io" rel="external nofollow noreferrer">Mamba_girl</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://xlxlll.github.io/2020/04/17/Spark/">https://xlxlll.github.io/2020/04/17/Spark/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        Reprint policy:
                    </i>
                </span>
                <span class="reprint-info">
                    All articles in this blog are used except for special statements
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    reprint polocy. If reproduced, please indicate source
                    <a href="https://xlxlll.github.io" target="_blank">Mamba_girl</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>Copied successfully, please follow the reprint policy of this article</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">more</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/big-data/">
                                    <span class="chip bg-color">big_data</span>
                                </a>
                            
                                <a href="/tags/Spark/">
                                    <span class="chip bg-color">Spark</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">

<div id="article-share">
    
    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>
            
        </div>
    </div>

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2020/04/25/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%9E%E6%88%98%E8%AE%B0%E5%BD%95/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/20.jpg" class="responsive-img" alt="大数据实战记录">
                        
                        <span class="card-title">大数据实战记录</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            对所实现大数据项目的一个复盘，对所涉及到的数据的采集、转化处理、实时计算、存储过程及数据展示的整个流程进行梳理，通过此次实战，了解企业级大数据项目开发的完整流程及整体架构设计。
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2020-04-25
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/big-data/" class="post-category">
                                    big_data
                                </a>
                            
                            <a href="/categories/big-data/Hadoop/" class="post-category">
                                    Hadoop
                                </a>
                            
                            <a href="/categories/big-data/Hadoop/Spark/" class="post-category">
                                    Spark
                                </a>
                            
                            <a href="/categories/big-data/Hadoop/Spark/Java/" class="post-category">
                                    Java
                                </a>
                            
                            <a href="/categories/big-data/Hadoop/Spark/Java/HBase/" class="post-category">
                                    HBase
                                </a>
                            
                            <a href="/categories/big-data/Hadoop/Spark/Java/HBase/Linux/" class="post-category">
                                    Linux
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/HBase/">
                        <span class="chip bg-color">HBase</span>
                    </a>
                    
                    <a href="/tags/Kafka/">
                        <span class="chip bg-color">Kafka</span>
                    </a>
                    
                    <a href="/tags/Spark/">
                        <span class="chip bg-color">Spark</span>
                    </a>
                    
                    <a href="/tags/Haoop/">
                        <span class="chip bg-color">Haoop</span>
                    </a>
                    
                    <a href="/tags/Flume/">
                        <span class="chip bg-color">Flume</span>
                    </a>
                    
                    <a href="/tags/Hive/">
                        <span class="chip bg-color">Hive</span>
                    </a>
                    
                    <a href="/tags/Hue/">
                        <span class="chip bg-color">Hue</span>
                    </a>
                    
                    <a href="/tags/MySQL/">
                        <span class="chip bg-color">MySQL</span>
                    </a>
                    
                    <a href="/tags/Websocket/">
                        <span class="chip bg-color">Websocket</span>
                    </a>
                    
                    <a href="/tags/Echarts/">
                        <span class="chip bg-color">Echarts</span>
                    </a>
                    
                    <a href="/tags/Java/">
                        <span class="chip bg-color">Java</span>
                    </a>
                    
                    <a href="/tags/Scala/">
                        <span class="chip bg-color">Scala</span>
                    </a>
                    
                    <a href="/tags/shell/">
                        <span class="chip bg-color">shell</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2020/04/17/Hue/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/8.jpg" class="responsive-img" alt="Hue">
                        
                        <span class="card-title">Hue</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            记录学习和使用Hue，笔记持续更新...
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2020-04-17
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/big-data/" class="post-category">
                                    big_data
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/HBase/">
                        <span class="chip bg-color">HBase</span>
                    </a>
                    
                    <a href="/tags/Hive/">
                        <span class="chip bg-color">Hive</span>
                    </a>
                    
                    <a href="/tags/Hue/">
                        <span class="chip bg-color">Hue</span>
                    </a>
                    
                    <a href="/tags/HDFS/">
                        <span class="chip bg-color">HDFS</span>
                    </a>
                    
                    <a href="/tags/YARN/">
                        <span class="chip bg-color">YARN</span>
                    </a>
                    
                    <a href="/tags/Mysql/">
                        <span class="chip bg-color">Mysql</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('120')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + '来源: 博客乐园<br />'
            + 'Manba_girl: Mamba_girl<br />'
            + '链接: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者所有，任何形式的转载都请注明出处。';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>


<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>

    
<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


<!-- 代码块折行 -->

<style type="text/css">
code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }
</style>

    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h1, h2, h3, h4, h5, h6'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h1, h2, h3, h4, h5, h6').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>



    <footer class="page-footer bg-color">
    <div class="container row center-align" style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
			<span id="sitetime"></span>
            <span id="year">2019</span>
            <a href="https://xlxlll.github.io" target="_blank">Mamba_girl</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                class="white-color">48k</span>&nbsp;字
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv" style='display:none'></span>
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            
            
            
            <span id="busuanzi_container_site_uv" style='display:none'></span>
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            
            
            <br>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/blinkfox" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:1181062873@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1181062873" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1181062873" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>

<script>
    $(document).ready(function () {

        var int = setInterval(fixCount, 50);  // 50ms周期检测函数
        var pvcountOffset = 80000;  // 初始化首次数据
        var uvcountOffset = 20000;

        function fixCount() {
            if (document.getElementById("busuanzi_container_site_pv").style.display != "none") {
                $("#busuanzi_value_site_pv").html(parseInt($("#busuanzi_value_site_pv").html()) + pvcountOffset);
                clearInterval(int);
            }
            if ($("#busuanzi_container_site_pv").css("display") != "none") {
                $("#busuanzi_value_site_uv").html(parseInt($("#busuanzi_value_site_uv").html()) + uvcountOffset); // 加上初始数据 
                clearInterval(int); // 停止检测
            }
        }
    });
</script>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜一搜</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索关键词"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/" + "search.xml", 'searchInput', 'searchResult');
});
</script>
    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Global site tag (gtag.js) - Google Analytics -->


    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    

    

    
    <script type="text/javascript" src="/libs/background/ribbon-dynamic.js" async="async"></script>
    
    
    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    
	<script type="text/javascript">
    var OriginTitile = document.title,
        st;
    document.addEventListener("visibilitychange", function () {
        document.hidden ? (document.title = "正在赶来的路上🙈~正在赶来的路上🙈~", clearTimeout(st)) : (document.title =
            "(๑•̀ㅂ•́) ✧哇哦，来了～", st = setTimeout(function () {
                document.title = OriginTitile
            }, 3e3))
    })
</script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/shizuku.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":false},"react":{"opacity":0.7}});</script></body>

</html>
